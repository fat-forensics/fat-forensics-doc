

<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
  
    <title>fatf.transparency.predictions.counterfactuals.CounterfactualExplainer &#8212; FAT Forensics 0.0.1 documentation</title>
  <!-- html title is before nature.css - we use this hack to load bootstrap first -->
  <!-- Required meta tags -->
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <!-- Bootstrap CSS -->
  <link rel="stylesheet" href="../_static/css/bootstrap.min.css">

    <link rel="stylesheet" href="../_static/nature.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/gallery.css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/language_data.js"></script>
    <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS_SVG"></script>
    <link rel="canonical" href="https://fat-forensics.org/generated/fatf.transparency.predictions.counterfactuals.CounterfactualExplainer.html" />
    <link rel="shortcut icon" href="../_static/fatf.ico"/>
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="fatf.transparency.predictions.counterfactuals.textualise_counterfactuals" href="fatf.transparency.predictions.counterfactuals.textualise_counterfactuals.html" />
    <link rel="prev" title="fatf.transparency.models.lime.Lime" href="fatf.transparency.models.lime.Lime.html" />
  <!-- jQuery first, then Bootstrap JS -->
  <!-- jQuery is distributed with Sphinx already -->
  <!-- <script src="../_static/jquery.min.js"></script> -->
  <script src="../_static/js/bootstrap.min.js"></script>

  </head><body>
<div class="container">
  <nav class="navbar navbar-expand-md navbar-light bg-light">
    <a class="navbar-brand align-text-middle" href="../index.html">
      <img src="../_static/fatf.png"
       alt="Logo"
       width="35" height="35"
       class="d-inline-block align-middle">
      FAT-Forensics
    </a>

    <button class="navbar-toggler"
            type="button"
            data-toggle="collapse"
            data-target="#navbarCollapsedContent">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div class="collapse navbar-collapse"
         id="navbarCollapsedContent">
      <ul class="navbar-nav mr-auto">
        <li class="nav-item">
          <a class="nav-link" href="../index.html">Home</a>
        </li>

        <li class="nav-item dropdown">
          <a class="nav-link dropdown-toggle" href="#" role="button" data-toggle="dropdown">
            Documentation
          </a>
          <div class="dropdown-menu">
            <div class="dropdown-header">FAT-Forensics</div>
            <div class="dropdown-divider"></div>
            <a class="dropdown-item" href="../getting_started/index.html">Getting Started</a>
            <a class="dropdown-item" href="../tutorials/index.html">Tutorials</a>
            <a class="dropdown-item" href="../sphinx_gallery_auto/index.html">Examples</a>
            <a class="dropdown-item" href="../api.html">API Reference</a>
            <a class="dropdown-item" href="../how_to/index.html">How-To Guides</a>
            <div class="dropdown-divider"></div>
            <a class="dropdown-item" href="../news.html">News</a>
            <a class="dropdown-item" href="../development.html">Developers Guide</a>
            <a class="dropdown-item" href="../contributors.html">Contributors</a>
            <a class="dropdown-item" href="../changelog.html">Changelog</a>
            <a class="dropdown-item" href="../roadmap.html">Roadmap</a>
          </div>
        </li>

        <li class="nav-item dropdown">
          <a class="nav-link dropdown-toggle" href="#" role="button" data-toggle="dropdown">
            FAT
          </a>
          <div class="dropdown-menu">
            <a class="dropdown-item" href="../user_guide/index.html">FAT User Guide</a>
            <div class="dropdown-divider"></div>
            <a class="dropdown-item" href="../user_guide/fairness/index.html"><b>F</b>airness</a>
            <a class="dropdown-item" href="../user_guide/accountability/index.html"><b>A</b>ccountability</a>
            <a class="dropdown-item" href="../user_guide/transparency/index.html"><b>T</b>ansparency</a>
          </div>
        </li>
      </ul>

      <div class="search_form form-inline">
          <div class="gcse-search" id="cse" style="width: 100%;"></div>
      </div>
    </div>
  </nav>
</div>

<!-- GitHub "fork me" ribbon -->
<!--
<a href="https://github.com/fat-forensics/fat-forensics">
  <img class="fork-me"
       style="position: absolute; top: 0; right: 0; border: 0;"
       src="../_static/img/forkme.png"
       alt="Fork me on GitHub" />
</a>
-->
<span id="forkongithub">
  <a href="https://github.com/fat-forensics/fat-forensics">
    Fork me on GitHub
  </a>
</span>
<div class="container">
  <div class="row">
    <div class="col-sm-2">
      <div class="container sidebar">
        <!--
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../index.html">
              <img class="logo" src="../_static/fatf.png" alt="Logo"/>
            </a></p>
  <h3><a href="../index.html">Table of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#"><code class="xref py py-mod docutils literal notranslate"><span class="pre">fatf.transparency.predictions.counterfactuals</span></code>.CounterfactualExplainer</a><ul>
<li><a class="reference internal" href="#examples-using-fatf-transparency-predictions-counterfactuals-counterfactualexplainer">Examples using <code class="docutils literal notranslate"><span class="pre">fatf.transparency.predictions.counterfactuals.CounterfactualExplainer</span></code></a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="fatf.transparency.models.lime.Lime.html"
                        title="previous chapter"><code class="xref py py-mod docutils literal notranslate"><span class="pre">fatf.transparency.models.lime</span></code>.Lime</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="fatf.transparency.predictions.counterfactuals.textualise_counterfactuals.html"
                        title="next chapter"><code class="xref py py-mod docutils literal notranslate"><span class="pre">fatf.transparency.predictions.counterfactuals</span></code>.textualise_counterfactuals</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/generated/fatf.transparency.predictions.counterfactuals.CounterfactualExplainer.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>-->
        <!-- Add a link to the 'up' page -->
        <div class="row rel">
          <div class="col rellink pad-b-1">
            <a class="btn btn-primary btn-sm"
               href="../api.html"
               role="button">
              Up
              <br/>
              <span class="smallrellink">
                API Reference (0.0.1)
              </span>
              <span class="hiddenrellink left-button">
                API Reference (0.0.1)
              </span>
              
            </a>
          </div>
        </div>

        <!-- Add a links to the 'relative' pages -->

        <div class="row rel">
          <div class="col-6 rellink
                      pad-r-1
                      ">
            <a class="btn btn-primary btn-sm"
               href="fatf.transparency.models.lime.Lime.html"
               accesskey="P"
               role="button">
              Previous
              <br/>
              <span class="smallrellink">
                fatf.transpar...
              </span>
                  <span class="hiddenrellink
                               left-button
                               "
                        data-container="body">
                  fatf.transparency.models.lime.Lime
                  </span>
            </a>
          </div>
          <div class="col-6 rellink
                      pad-l-1
                      ">
            <a class="btn btn-primary btn-sm"
               href="fatf.transparency.predictions.counterfactuals.textualise_counterfactuals.html"
               accesskey="N"
               role="button">
              Next
              <br/>
              <span class="smallrellink">
                fatf.transpar...
              </span>
                  <span class="hiddenrellink
                               right-button
                               "
                        data-container="body">
                  fatf.transparency.predictions.counterfactuals.textualise_counterfactuals
                  </span>
            </a>
          </div>
        </div>

        

        <!-- Add a citation banner -->
        <div class="alert alert-info" role="alert" style="font-size: 89%; margin-top: 16px;">
          Please <a href="../getting_started/cite.html"><b>cite us</b></a> if you use the software.
        </div>

        <!-- Add a page map -->

        <div class="row toc">
          <ul>
<li><a class="reference internal" href="#"><code class="xref py py-mod docutils literal notranslate"><span class="pre">fatf.transparency.predictions.counterfactuals</span></code>.CounterfactualExplainer</a><ul>
<li><a class="reference internal" href="#examples-using-fatf-transparency-predictions-counterfactuals-counterfactualexplainer">Examples using <code class="docutils literal notranslate"><span class="pre">fatf.transparency.predictions.counterfactuals.CounterfactualExplainer</span></code></a></li>
</ul>
</li>
</ul>

        </div>

      </div>
    </div>
    

    <div class="col col-sm-10">
      <div class="container">
        <div class="row">
        
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="fatf-transparency-predictions-counterfactuals-counterfactualexplainer">
<h1><a class="reference internal" href="../api.html#module-fatf.transparency.predictions.counterfactuals" title="fatf.transparency.predictions.counterfactuals"><code class="xref py py-mod docutils literal notranslate"><span class="pre">fatf.transparency.predictions.counterfactuals</span></code></a>.CounterfactualExplainer<a class="headerlink" href="#fatf-transparency-predictions-counterfactuals-counterfactualexplainer" title="Permalink to this headline">¶</a></h1>
<dl class="class">
<dt id="fatf.transparency.predictions.counterfactuals.CounterfactualExplainer">
<em class="property">class </em><code class="descclassname">fatf.transparency.predictions.counterfactuals.</code><code class="descname">CounterfactualExplainer</code><span class="sig-paren">(</span><em>model: object = None, predictive_function: Optional[Callable] = None, dataset: Optional[numpy.ndarray] = None, categorical_indices: Optional[List[Union[str, int]]] = None, numerical_indices: Optional[List[Union[str, int]]] = None, counterfactual_feature_indices: Optional[List[Union[str, int]]] = None, max_counterfactual_length: int = 2, feature_ranges: Optional[Dict[Union[int, str], Union[Tuple[float, float], List[Union[float, str]]]]] = None, distance_functions: Optional[Dict[Union[int, str], Callable]] = None, step_sizes: Optional[Dict[Union[int, str], float]] = None, default_numerical_step_size: float = 1.0</em><span class="sig-paren">)</span><a class="reference external" href="https://github.com/fat-forensics/fat-forensics/blob/2758606/fatf/transparency/predictions/counterfactuals.py#L36"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#fatf.transparency.predictions.counterfactuals.CounterfactualExplainer" title="Permalink to this definition">¶</a></dt>
<dd><p>Generates counterfactual explanations of black-box classifier predictions.</p>
<p>Finds counterfactual explanations for an arbitrary black-box <strong>classifier</strong>
by a brute-force grid search with a specified step size for a selected
range of values for selected features in the dataset.</p>
<p>In order to generate the counterfactuals either a <code class="docutils literal notranslate"><span class="pre">model</span></code> or a
<code class="docutils literal notranslate"><span class="pre">predictive_function</span></code> must be given.</p>
<p>If a <code class="docutils literal notranslate"><span class="pre">dataset</span></code> is given, then only one of the two column indices
parameters is required: <code class="docutils literal notranslate"><span class="pre">categorical_indices</span></code> or <code class="docutils literal notranslate"><span class="pre">numerical_indices</span></code>.
If a dataset is not given, both these parameters need to be specified.</p>
<p>If only some of the features are desired to appear in the counterfactuals,
then these may be specified in the <code class="docutils literal notranslate"><span class="pre">counterfactual_feature_indices</span></code>
parameter.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Valid feature (column) indices are either strings for structured arrays
or integers for normal numpy arrays.</p>
</div>
<p>The user may also wish to restrict the length of any generated
counterfactual by providing the <code class="docutils literal notranslate"><span class="pre">max_counterfactual_length</span></code> parameter.</p>
<p>If a <code class="docutils literal notranslate"><span class="pre">dataset</span></code> is given, then the feature ranges will be obtained by
taking the minimum and the maximum value for numerical features and all the
unique values for categorical (textual) features. Alternatively, the user
may wish to define feature ranges by using the <code class="docutils literal notranslate"><span class="pre">feature_ranges</span></code>
parameter. All undefined feature ranges will be filled in automatically
given that a <code class="docutils literal notranslate"><span class="pre">dataset</span></code> is provided. If some of the feature ranges are not
defined and a <code class="docutils literal notranslate"><span class="pre">dataset</span></code> is not given an exception will be raised.
<strong>Counterfactuals will only be search for within these feature ranges.</strong>
Ranges are only required for features specified by the
<code class="docutils literal notranslate"><span class="pre">counterfactual_feature_indices</span></code> parameter or all features if this
parameter is not given.</p>
<p>For a given feature combination only the counterfactual(s) closest to the
specified data point will be retrieved. By default the distance for every
numerical feature is taken to be <span class="math notranslate nohighlight">\(abs(x_i - \hat{x}_i)\)</span> and for
every categorical feature it is an identity function, i.e. <span class="math notranslate nohighlight">\(1\)</span> if the
value does not agree and <span class="math notranslate nohighlight">\(0\)</span> if it agrees. If custom distance
functions are desired, the user may specify these via the
<code class="docutils literal notranslate"><span class="pre">distance_functions</span></code> parameter. Each distance function has to be a
<code class="docutils literal notranslate"><span class="pre">Callable</span></code> with two input parameters. Finally, the distance can be
normalised, please see the documentation of the <code class="docutils literal notranslate"><span class="pre">_get_distance</span></code> method
for details.</p>
<p>Last but not least, when doing grid search through the features to discover
counterfactual data points the user may define the step size between the
minimum and the maximum value for the numerical features. This can be done
selectively for every single feature separately via the <code class="docutils literal notranslate"><span class="pre">step_sizes</span></code>
parameter. For all of the features that step size is not defined the
default value (<span class="math notranslate nohighlight">\(1\)</span>) will be taken – this can be changed via the
<code class="docutils literal notranslate"><span class="pre">default_numerical_step_size</span></code> parameter.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><dl class="simple">
<dt><strong>model</strong><span class="classifier">object, optional (default=None)</span></dt><dd><p>A predictive model object that has a <code class="docutils literal notranslate"><span class="pre">predict</span></code> method.</p>
</dd>
<dt><strong>predictive_function</strong><span class="classifier">Callable, optional (default=None)</span></dt><dd><p>A function that takes in a 2-dimensional data array and returns class
predictions. (Alternative to the <code class="docutils literal notranslate"><span class="pre">model</span></code> parameter.)</p>
</dd>
<dt><strong>dataset</strong><span class="classifier">numpy.ndarray, optional (default=None)</span></dt><dd><p>A 2-dimensional data array representing a dataset used for the problem
modeling. It is advised to use the same dataset as for the training of
the <code class="docutils literal notranslate"><span class="pre">model</span></code> object.</p>
</dd>
<dt><strong>categorical_indices</strong><span class="classifier">List[column indices], optional (default=None)</span></dt><dd><p>A list of column indices indicating which columns are categorical.</p>
</dd>
<dt><strong>numerical_indices</strong><span class="classifier">List[column indices], optional (default=None)</span></dt><dd><p>A list of column indices indicating which columns are numerical.</p>
</dd>
<dt><strong>counterfactual_feature_indices</strong><span class="classifier">List[column indices], optional (default=None)</span></dt><dd><p>A list of column indices indicating which features should be used to
compose counterfactual examples. If <cite>None`</cite> all of the features will be
used to generate counterfactuals.</p>
</dd>
<dt><strong>max_counterfactual_length</strong><span class="classifier">integer, optional (default=2)</span></dt><dd><p>The maximum length of counterfactuals – the number of features altered
to compose a counterfactual instance. By default it is set to 2. If set
to 0, all available features will be used.</p>
</dd>
<dt><strong>feature_ranges</strong><span class="classifier">Dictionary[column indices, ranges], optional (default=None)</span></dt><dd><p>A dictionary with keys representing the column (feature) indices and
the values representing feature ranges. Numerical feature ranges are
represented as a <strong>pair</strong> of numbers <code class="docutils literal notranslate"><span class="pre">(min,</span> <span class="pre">max)</span></code> where the first
number is the lower bound of the range and the second number is the
upper bound of the range. For categorical features this should be a
<strong>list</strong> of all the values that to be tested for this feature. If set
to <code class="docutils literal notranslate"><span class="pre">None</span></code>, a <code class="docutils literal notranslate"><span class="pre">dataset</span></code> has to be provided to calculate these
ranges.</p>
</dd>
<dt><strong>distance_functions</strong><span class="classifier">Dictionary[column indices, Callable], optional (default=None)</span></dt><dd><p>A dictionary with keys representing the column (feature) indices and
the values representing Python functions – a Callable that takes two
arguments – that will be used to calculate the distance for this
particular feature.</p>
</dd>
<dt><strong>step_sizes</strong><span class="classifier">Dictionary[column indices, Number], optional (default=None)</span></dt><dd><p>A dictionary with keys representing the column (feature) indices and
the values representing step size for the grid search of this feature.
<strong>It is only required for the numerical features.</strong></p>
</dd>
<dt><strong>default_numerical_step_size</strong><span class="classifier">Number, optional (default=1)</span></dt><dd><p>The default step size used with the grid search of numerical features
when generating counterfactuals.</p>
</dd>
</dl>
</dd>
<dt class="field-even">Attributes</dt>
<dd class="field-even"><dl class="simple">
<dt><strong>predict</strong><span class="classifier">Callable</span></dt><dd><p>A function used to predict the class of counterfactuals.</p>
</dd>
<dt><strong>all_indices</strong><span class="classifier">Set[column indices]</span></dt><dd><p>A set of all the column (feature) indices in the data set from which
counterfactuals are generated.</p>
</dd>
<dt><strong>categorical_indices</strong><span class="classifier">Set[column indices]</span></dt><dd><p>A set of categorical columns (feature) indices in the data set.</p>
</dd>
<dt><strong>numerical_indices</strong><span class="classifier">Set[column indices]</span></dt><dd><p>A set of numerical columns (feature) indices in the data set.</p>
</dd>
<dt><strong>cf_feature_indices</strong><span class="classifier">Set[column indices]</span></dt><dd><p>A set of column (feature) indices that will be used to generate
counterfactuals – only alterations of these features will be searched
to generate counterfactuals.</p>
</dd>
<dt><strong>feature_ranges</strong><span class="classifier">Dictionary[column indices, ranges]</span></dt><dd><p>A dictionary with ranges for all of the <code class="docutils literal notranslate"><span class="pre">cf_feature_indices</span></code>.</p>
</dd>
<dt><strong>max_counterfactual_length</strong><span class="classifier">Number</span></dt><dd><p>The maximum length – the number of features altered – of a
counterfactual instance.</p>
</dd>
<dt><strong>distance_functions</strong><span class="classifier">Dictionary[column indices, Callable]</span></dt><dd><p>A dictionary with distance functions for all of the
<code class="docutils literal notranslate"><span class="pre">cf_feature_indices</span></code>.</p>
</dd>
<dt><strong>step_sizes</strong><span class="classifier">Dictionary[column indices, Numbers]</span></dt><dd><p>A dictionary with step sizes for all of the numerical features in the
<code class="docutils literal notranslate"><span class="pre">cf_feature_indices</span></code>.</p>
</dd>
</dl>
</dd>
<dt class="field-odd">Raises</dt>
<dd class="field-odd"><dl class="simple">
<dt><strong>AttributeError</strong></dt><dd><p>The <code class="docutils literal notranslate"><span class="pre">predictive_function</span></code> parameter, if given, does not require 2
non-optional parameters. One of the distance functions provided via the
<code class="docutils literal notranslate"><span class="pre">distance_functions</span></code> parameter does not require 2 non-optional
parameters.</p>
</dd>
<dt><strong>IncorrectShapeError</strong></dt><dd><p>The <code class="docutils literal notranslate"><span class="pre">dataset</span></code> array is not 2-dimensional.</p>
</dd>
<dt><strong>IndexError</strong></dt><dd><p>Some of the <code class="docutils literal notranslate"><span class="pre">categorical_indices</span></code> or <code class="docutils literal notranslate"><span class="pre">numerical_indices</span></code> are not
valid for the input <code class="docutils literal notranslate"><span class="pre">dataset</span></code>, when the latter is given. When both
<code class="docutils literal notranslate"><span class="pre">categorical_indices</span></code> and <code class="docutils literal notranslate"><span class="pre">numerical_indices</span></code> parameters are given
alongside a <code class="docutils literal notranslate"><span class="pre">dataset</span></code> they do not cover all of the <code class="docutils literal notranslate"><span class="pre">dataset</span></code>
arrays’ column indices. The union of categorical and numerical indices
does not form a series of consecutive integers when the <code class="docutils literal notranslate"><span class="pre">dataset</span></code>
array is a classic numpy array. Some of the
<code class="docutils literal notranslate"><span class="pre">counterfactual_feature_indices</span></code> are not valid. Some of the indices
(dictionary keys) in the <code class="docutils literal notranslate"><span class="pre">feature_ranges</span></code>, <code class="docutils literal notranslate"><span class="pre">distance_functions</span></code> or
<code class="docutils literal notranslate"><span class="pre">step_sizes</span></code> parameters are not valid (consistent with the provided
column indices).</p>
</dd>
<dt><strong>RuntimeError</strong></dt><dd><p>The <code class="docutils literal notranslate"><span class="pre">model</span></code> object, if provided, lacks a <code class="docutils literal notranslate"><span class="pre">predict</span></code> method. Neither
<code class="docutils literal notranslate"><span class="pre">model</span></code> nor <code class="docutils literal notranslate"><span class="pre">predictive_function</span></code> was specified – one of these is
required.</p>
</dd>
<dt><strong>TypeError</strong></dt><dd><p>The <code class="docutils literal notranslate"><span class="pre">predictive_function</span></code> parameter is not Python callable, i.e. a
Python function. The <code class="docutils literal notranslate"><span class="pre">categorical_indices</span></code> parameter is neither a
list nor <code class="docutils literal notranslate"><span class="pre">None</span></code>. The <code class="docutils literal notranslate"><span class="pre">numerical_indices</span></code> parameter is neither a
list nor <code class="docutils literal notranslate"><span class="pre">None</span></code>. Some of the indices given in these two lists do not
share a common type – only all strings or all integers are allowed.
The <code class="docutils literal notranslate"><span class="pre">counterfactual_feature_indices</span></code> parameter is neither a list nor
<code class="docutils literal notranslate"><span class="pre">None</span></code>. The <code class="docutils literal notranslate"><span class="pre">max_counterfactual_length</span></code> parameter is not an
integer. The <code class="docutils literal notranslate"><span class="pre">feature_ranges</span></code> parameter is neither a dictionary nor
nor <code class="docutils literal notranslate"><span class="pre">None</span></code>. A feature range is not a list for a categorical feature
or a feature range is not a tuple for a numerical feature. One of the
numerical range tuple elements is not a number or all of the elements
of a categorical feature range do not share the same type. The
<code class="docutils literal notranslate"><span class="pre">distance_functions</span></code> parameter is not a dictionary. One of the
distance functions defined via the <code class="docutils literal notranslate"><span class="pre">distance_functions</span></code> parameter is
not a Python callable. The <code class="docutils literal notranslate"><span class="pre">step_sizes</span></code> parameter is not dictionary.
One of the step sizes defined via the <code class="docutils literal notranslate"><span class="pre">step_sizes</span></code> parameter is not
a number. The <code class="docutils literal notranslate"><span class="pre">default_numerical_step_size</span></code> parameter is not a
number.</p>
</dd>
<dt><strong>ValueError</strong></dt><dd><p>Some of the categorical (textual) features in the <code class="docutils literal notranslate"><span class="pre">dataset</span></code> array
(when given) are not indicated by the user – given via the
<code class="docutils literal notranslate"><span class="pre">categorical_indices</span></code> parameter – to be categorical (it is not
possible to treat textual fields as numerical features. Some of the
categorical features in the <code class="docutils literal notranslate"><span class="pre">dataset</span></code> array are selected to be
numerical via the <code class="docutils literal notranslate"><span class="pre">numerical_indices</span></code> parameter. Some of the feature
ranges are missing and need to be computed from a <code class="docutils literal notranslate"><span class="pre">dataset</span></code> but none
is given. <code class="docutils literal notranslate"><span class="pre">categorical_indices</span></code> and <code class="docutils literal notranslate"><span class="pre">numerical_indices</span></code>
parameters were not provided in the absence of a <code class="docutils literal notranslate"><span class="pre">dataset</span></code>. The
<code class="docutils literal notranslate"><span class="pre">dataset</span></code> array is not of a base type (strings and/or numbers). Both
<code class="docutils literal notranslate"><span class="pre">categorical_indices</span></code> and <code class="docutils literal notranslate"><span class="pre">numerical_indices</span></code> parameters are empty
lists. Both of these lists share some common indices. The
<code class="docutils literal notranslate"><span class="pre">counterfactual_feature_indices</span></code> parameter is an empty list. The
<code class="docutils literal notranslate"><span class="pre">max_counterfactual_length</span></code> parameter is not a non-negative integer.
The <code class="docutils literal notranslate"><span class="pre">feature_ranges</span></code> parameter is an empty dictionary. One of the
categorical ranges provided is an empty list. One of the numerical
ranges is a tuple of length different than 2 or the second element of
the range tuple is not strictly larger than the first one. The
<code class="docutils literal notranslate"><span class="pre">distance_functions</span></code> parameter is an empty dictionary. The
<code class="docutils literal notranslate"><span class="pre">step_sizes</span></code> parameter is an empty dictionary. Some of the step sizes
specified via the <code class="docutils literal notranslate"><span class="pre">step_sizes</span></code> dictionary are not strictly positive
numbers. The <code class="docutils literal notranslate"><span class="pre">default_numerical_step_size</span></code> parameter is not a
strictly positive number. When discovering feature ranges from the
<code class="docutils literal notranslate"><span class="pre">dataset</span></code> there is only one value for a numerical feature meaning
that a range cannot be created.</p>
</dd>
</dl>
</dd>
<dt class="field-even">Warns</dt>
<dd class="field-even"><dl class="simple">
<dt><strong>UserWarning</strong></dt><dd><p>The value of the <code class="docutils literal notranslate"><span class="pre">max_counterfactual_length</span> <span class="pre">parameter</span></code> is larger than
the number of features. A step size (via the <code class="docutils literal notranslate"><span class="pre">step_sizes</span></code> parameter)
is provided for one of the categorical features. Both a <code class="docutils literal notranslate"><span class="pre">model</span></code> and a
<code class="docutils literal notranslate"><span class="pre">predictive_function</span></code> parameters are supplied. When discovering
categorical feature ranges from the <code class="docutils literal notranslate"><span class="pre">dataset</span></code> there is only one
unique value for any particular feature.</p>
</dd>
</dl>
</dd>
</dl>
<p class="rubric">Methods</p>
<table class="longtable docutils align-center">
<colgroup>
<col style="width: 10%" />
<col style="width: 90%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p><a class="reference internal" href="#fatf.transparency.predictions.counterfactuals.CounterfactualExplainer.explain_instance" title="fatf.transparency.predictions.counterfactuals.CounterfactualExplainer.explain_instance"><code class="xref py py-obj docutils literal notranslate"><span class="pre">explain_instance</span></code></a>(instance, numpy.void], …)</p></td>
<td><p>Finds counterfactual data points, their class and distance.</p></td>
</tr>
</tbody>
</table>
<dl class="method">
<dt id="fatf.transparency.predictions.counterfactuals.CounterfactualExplainer.explain_instance">
<code class="descname">explain_instance</code><span class="sig-paren">(</span><em>instance: Union[numpy.ndarray, numpy.void], counterfactual_class: Union[int, str, None] = None, normalise_distance: bool = False</em><span class="sig-paren">)</span> &#x2192; Tuple[numpy.ndarray, numpy.ndarray, numpy.ndarray]<a class="reference external" href="https://github.com/fat-forensics/fat-forensics/blob/2758606/fatf/transparency/predictions/counterfactuals.py#L714"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#fatf.transparency.predictions.counterfactuals.CounterfactualExplainer.explain_instance" title="Permalink to this definition">¶</a></dt>
<dd><p>Finds counterfactual data points, their class and distance.</p>
<p>Returns a numpy array with counterfactual instances, their predicted
classes and distances for a given data <code class="docutils literal notranslate"><span class="pre">instance</span></code>. The counterfactual
class can be selected by the user, otherwise all possible classes are
considered.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><dl class="simple">
<dt><strong>instance</strong><span class="classifier">numpy.ndarray or numpy.void</span></dt><dd><p>A 1-dimensional numpy array representing a data point for which
counterfactuals are desired.</p>
</dd>
<dt><strong>counterfactual_class</strong><span class="classifier">string or integer, optional (default=None)</span></dt><dd><p>A class of counterfactual instances. If <code class="docutils literal notranslate"><span class="pre">None</span></code> counterfactuals of
all classes other than the predicted class of the input
<code class="docutils literal notranslate"><span class="pre">instance</span></code> will be returned.</p>
</dd>
<dt><strong>normalise_distance</strong><span class="classifier">boolean, optional (default=False)</span></dt><dd><p>Whether to normalise the distance, cf. the <code class="docutils literal notranslate"><span class="pre">_get_distance</span></code> method
for more details.</p>
</dd>
</dl>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><dl class="simple">
<dt><strong>counterfactuals</strong><span class="classifier">numpy.ndarray</span></dt><dd><p>A 2-dimensional numpy array with counterfactual data points.</p>
</dd>
<dt><strong>counterfactuals_distances</strong><span class="classifier">numpy.ndarray</span></dt><dd><p>A 1-dimensional numpy array with distances from the input
<code class="docutils literal notranslate"><span class="pre">instance</span></code> to every counterfactual data point.</p>
</dd>
<dt><strong>counterfactuals_predictions</strong><span class="classifier">numpy.ndarray</span></dt><dd><p>A 1-dimensional numpy array with predictions for every
counterfactual data point.</p>
</dd>
</dl>
</dd>
<dt class="field-odd">Raises</dt>
<dd class="field-odd"><dl class="simple">
<dt><strong>IncorrectShapeError</strong></dt><dd><p>The input <code class="docutils literal notranslate"><span class="pre">instance</span></code> is not a 1-dimensional numpy array.</p>
</dd>
<dt><strong>IndexError</strong></dt><dd><p>The indices that were used to initialise this class are not valid
for the given input <code class="docutils literal notranslate"><span class="pre">instance</span></code>.</p>
</dd>
<dt><strong>TypeError</strong></dt><dd><p>The <code class="docutils literal notranslate"><span class="pre">counterfactual_class</span></code> parameter is neither string not
integer. The <code class="docutils literal notranslate"><span class="pre">normalise_distance</span></code> parameter is not a boolean.</p>
</dd>
<dt><strong>ValueError</strong></dt><dd><p>The input <code class="docutils literal notranslate"><span class="pre">instance</span></code> is not of a base type (string and/or
integer).</p>
</dd>
</dl>
</dd>
<dt class="field-even">Warns</dt>
<dd class="field-even"><dl class="simple">
<dt><strong>UserWarning</strong></dt><dd><p>When generating counterfactuals the value of one of the features
for the specified input <code class="docutils literal notranslate"><span class="pre">instance</span></code> is outside of the specified
range for this feature.</p>
</dd>
</dl>
</dd>
</dl>
</dd></dl>

</dd></dl>

<div class="section" id="examples-using-fatf-transparency-predictions-counterfactuals-counterfactualexplainer">
<h2>Examples using <code class="docutils literal notranslate"><span class="pre">fatf.transparency.predictions.counterfactuals.CounterfactualExplainer</span></code><a class="headerlink" href="#examples-using-fatf-transparency-predictions-counterfactuals-counterfactualexplainer" title="Permalink to this headline">¶</a></h2>
<div class="sphx-glr-thumbcontainer" tooltip="This example illustrates how to use the Counterfactual Prediction explainer (:class:`fatf.trans..."><div class="figure align-center" id="id1">
<img alt="../_images/sphx_glr_xmpl_transparency_cf_thumb.png" src="../_images/sphx_glr_xmpl_transparency_cf_thumb.png" />
<p class="caption"><span class="caption-text"><a class="reference internal" href="../sphinx_gallery_auto/transparency/xmpl_transparency_cf.html#sphx-glr-sphinx-gallery-auto-transparency-xmpl-transparency-cf-py"><span class="std std-ref">Using Counterfactual Prediction Explainer</span></a></span><a class="headerlink" href="#id1" title="Permalink to this image">¶</a></p>
</div>
</div><div class="clear:both"></div></div>
</div>


          </div>
        </div>
      </div>
        </div>
      </div>
    </div>
  </div>
</div>

  <div class="container cusotm-footer">
    <div class="row">
      <div class="col-3">
        &copy; 2018--2019, Kacper Sokol et al.
      </div>
      <div class="col-6">
        <a class="footer-img-link" href="contributors.html#funding">
          <img src="../_static/img/bristol.svg" title="Univeristy of Bristol" style="max-height: 30px">
          &nbsp;
          <img src="../_static/img/thales.svg" title="Thales" style="max-height: 20px">
        </a>
        <br>
        <a href="contributors.html#funding" style="top: 4px; position: relative;">
          More information on our contributors
        </a>
      </div>
      <div class="col-3">
        <a href="../_sources/generated/fatf.transparency.predictions.counterfactuals.CounterfactualExplainer.rst.txt" rel="nofollow">
          Show this page source
        </a>
      </div>
    </div>
  </div>

  
  <script>
    window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
    ga('create', 'UA-142154492-1', 'auto');
    ga('set', 'anonymizeIp', true);
    ga('send', 'pageview');
  </script>
  <script async src='https://www.google-analytics.com/analytics.js'></script>
  

  
  <script>
    (function() {
      var cx = '014039732624725851926:mpducezglrq';
      var gcse = document.createElement('script');
      gcse.type = 'text/javascript';
      gcse.async = true;
      gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
      var s = document.getElementsByTagName('script')[0];
      s.parentNode.insertBefore(gcse, s);
    })();
  </script>
  
  </body>
</html>